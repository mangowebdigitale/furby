<%
START_COLLAPSED = true
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <title>Furby</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex,nofollow,noarchive">

    <script src="http://code.jquery.com/jquery.js"></script>    
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/css/bootstrap.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-wip/js/bootstrap.min.js"></script>

    <style media="screen" type="text/css">
      .panel-heading {
        padding-top: 4px;
        padding-bottom: 4px;
        border-bottom: 0px;
      }
      .panel {
        margin-bottom: 0px;
        border-radius: 0px;
        border-bottom-width: 1px;
        border-top-width: 0px;
        border-left-width: 0px;
        border-right-width: 0px;
      }
    </style>
    
    <script type="text/javascript">
        toggleStatus = false;
        function togglePanels() {
            var panels = document.getElementsByClassName("panel-collapse");
            var panel;
            for (i = panels.length - 1; i >= 0; --i) {
                panel = panels[i];
                panel.className = panel.className.replace(/(?:^|\s)in(?!\S)/g, '');
                if(!toggleStatus) panel.className += " in";
            }
            toggleStatus = !toggleStatus;
            var text = (toggleStatus ? "Collapse" : "Expand") + " All";
            document.getElementById("toggle-btn").text = text;
        }
    </script>
</head>
<body>
  <div class="container">
    <header>
      <div class="page-header">
        <h1>
          <b>furby</b>
          <small><%= DateTime::now.strftime "%F %R %Z" %></small>
          <div class="pull-right"><small><%= @version %></small></div>
        </h1>
      </div>
    </header>

    <% @errors.each do |url, status| %>
      <div class="alert alert-danger">
        <p>Feed <b><%= url %></b> returned code <b><%= status %></b>.</p>
      </div>
    <% end %>

    <a id="toggle-btn" class="btn btn-xs btn-default pull-right" onclick="togglePanels();">Expand All</a>
    <% @entries.group_by {|e| e.published.strftime("%A, %d %B %Y")}.each do |date, entries_| %>
      <h4 class="text-center"><date><%= date %></date></h4>
      <% entries_.each do |entry| %>
        <div class="panel panel-default">
          <div class="panel-heading" data-toggle="collapse" data-target="#entry<%= entry.hash %>">
            <b><a href="<%= entry.url %>"><%= entry.title %></a></b> - 
            <small><time><%= entry.published.strftime("%R") %></time></small>
            <div class="pull-right">
              <a href="<%= entry[:feed].url %>"><small><%= entry[:feed].title %></small></a>
            </div>
          </div>
          <div id="entry<%= entry.hash %>" class="panel-collapse collapse <%= "in" if not START_COLLAPSED %>">
            <div class="panel-body">
              <%= entry.content or entry.summary %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
      
    <div class="row">
      <div class="col-md-4">
        <table>
          <thead>
            <th>Feed</th><th>XML</th>
          </thead>
          <tbody>
            <% @feeds.each do |feed| %>
              <tr class="feedsrow">
                <td><a href="<%= feed.url %>"><%= feed.title %></a></td>
                <td><a class="xmlbutton" href="<%= feed.feed_url %>">XML</a></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <hr>
    <footer>
      <div class="row">
        <center><p>Generated by <a href="https://github.com/utdemir/furby">furby</a>.</p></center>
      </div>
    </footer>
  </div>
</body>
</html>
